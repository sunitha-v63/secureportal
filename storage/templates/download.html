{% extends 'layout.html' %}
{% load static %}
{% block css %}
<link rel="stylesheet" href="{% static 'css/download.css' %}">
{% endblock %}
{% block content %}

<div class="decrypt-container">

    <div class="decrypt-card">

        <div class="text-center mb-3">
            <i class="bi bi-shield-lock-fill lockfill" style="font-size: 48px;"></i>
        </div>

        <h3 class="text-center mb-3 title1">Secure Decryption</h3>

        <p class="text-muted text-center mb-1">
            You are downloading:
            <strong>{{ file.file_name }}</strong>
        </p>
        <p class="text-muted text-center small">
            Enter your <strong>account password</strong> to unlock your RSA private key.
        </p>

        <!-- Messages -->
{% if messages %}
    {% for message in messages %}
        {% if "download" in message.tags %}
            <div class="alert alert-{{ message.tags }}">{{ message }}</div>
        {% endif %}
    {% endfor %}
{% endif %}


        <form method="post" autocomplete="off" class="mt-3">
            {% csrf_token %}

            <label class="form-label fw-bold">Account Password</label>
            <div class="input-group mb-3">
                <input id="passphrase"
                       type="password"
                       name="passphrase"
                       class="form-control"
                       placeholder="Enter password"
                       autocomplete="current-password">

                <span class="input-group-text" style="cursor: pointer;" onclick="togglePassword()">
                    <i class="bi bi-eye" id="toggleIcon"></i>
                </span>
            </div>

            <button type="submit" class="btn btnunlock w-100">
                ðŸ”“ Unlock & Download
            </button>

            <p class="mt-3 text-center small text-muted">
                Your password is <strong>never stored</strong>.  
                It is used only to decrypt your private key for this download.
            </p>
        </form>

    </div>

</div>


<script>
function togglePassword() {
    const input = document.getElementById("passphrase");
    const icon = document.getElementById("toggleIcon");

    if (input.type === "password") {
        input.type = "text";
        icon.classList.replace("bi-eye", "bi-eye-slash");
    } else {
        input.type = "password";
        icon.classList.replace("bi-eye-slash", "bi-eye");
    }
}

document.addEventListener("DOMContentLoaded", function() {
    const form = document.querySelector("form");
    form.addEventListener("submit", function() {
        setTimeout(() => form.reset(), 400);
    });
});
</script>

{% endblock %}
