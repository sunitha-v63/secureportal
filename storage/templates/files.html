{% extends 'layout.html' %}
{% load static %}

{% block css %}
<link rel="stylesheet" href="{% static 'css/files.css' %}">
{% endblock %}
{% block content %}
<h2 class="page-title text-center mb-3">My Files</h2>
<div class="table-responsive">

  {% if messages %}
      {% for message in messages %}
          {% if "share" in message.tags %}
              <div class="alert alert-success">{{ message }}</div>
          {% endif %}
      {% endfor %}
  {% endif %}

  <table class="table table-striped align-middle">
    <thead class="table">
      <tr>
        <th scope="col">File Name</th>
        <th scope="col">Uploaded</th>
        <th scope="col" class="text-center">Actions</th>
      </tr>
    </thead>

    <tbody>
      {% for f in files %}
      <tr>
        <td class="fw-semibold">{{ f.file_name }}</td>
        <td>{{ f.uploaded_at|date:"M d, Y â€” H:i" }}</td>

        <td class="text-center">
          <div class="btn-group" role="group">

            <a class="btn btn-sm downloadbtn"
               href="{% url 'download' f.id %}">
              <i class="bi bi-download"></i> Download
            </a>

            <a class="btn btn-sm btn-outline-secondary"
               href="{% url 'share' f.id %}">
              <i class="bi bi-share"></i> Share
            </a>

            <button class="btn btn-sm btn-outline-danger"
                    onclick="openDeleteModal({{ f.id }})">
              <i class="bi bi-trash"></i> Delete
            </button>

          </div>
        </td>

      </tr>
      {% empty %}
      <tr>
        <td colspan="3" class="text-center text-muted py-3">
          No files uploaded yet.
        </td>
      </tr>
      {% endfor %}
    </tbody>

  </table>

</div>


<div class="modal fade" id="deleteModal" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">

      <div class="modal-header">
        <h5 class="modal-title">Confirm Delete</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>

      <div class="modal-body">
        <p>Are you sure you want to delete this file?</p>
      </div>

      <div class="modal-footer">
        <button type="button" class="btn cancelbtn" data-bs-dismiss="modal">Cancel</button>
        <a id="confirmDeleteBtn" class="btn delbtn">Delete</a>
      </div>

    </div>
  </div>
</div>

{% endblock %}
{% block js %}
<script>
function openDeleteModal(fileId) {
    let deleteUrl = "/delete/" + fileId + "/";  
    document.getElementById("confirmDeleteBtn").href = deleteUrl;

    let modal = new bootstrap.Modal(document.getElementById('deleteModal'));
    modal.show();
}
</script>

{% endblock %}
